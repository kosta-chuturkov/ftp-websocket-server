<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:aop="http://www.springframework.org/schema/aop"
	   xmlns="http://www.springframework.org/schema/beans"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans  http://www.springframework.org/schema/beans/spring-beans-3.2.xsd  http://www.springframework.org/schema/context  http://www.springframework.org/schema/context/spring-context-3.2.xsd  http://www.springframework.org/schema/tx  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd  http://www.springframework.org/schema/aop  http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"
	   default-lazy-init="true">

	<import resource="classpath:persistence/data-source-ApplicationContext.xml" />
	<beans>
		<context:property-placeholder location="classpath:conf.properties"
			ignore-unresolvable="true" system-properties-mode="OVERRIDE" />


		<tx:annotation-driven transaction-manager="transactionManager"
			order="200" />
		<bean
			class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />

		<bean id="transactionManager"
			class="org.springframework.orm.hibernate5.HibernateTransactionManager"
			p:sessionFactory-ref="sessionFactory" />

		<bean id="sessionFactory"
			class="ftp.core.persistance.hibernate.session.factory.CustomLocalSessionFactoryBean"
			p:dataSource-ref="dataSource">
			<!-- <property name="configLocation" value="classpath:hibernate/hibernate.cfg.xml"/> -->
			<property name="hibernateProperties">
				<props>
					<prop key="hibernate.dialect">${hibernate.dialect}</prop>
					<prop key="hibernate.generate_statistics">false</prop>
					<prop key="hibernate.show_sql">false</prop>
					<prop key="hibernate.hbm2ddl.auto">update</prop>
				</props>
			</property>
			<property name="packagesToScan" value="ftp.**.common.model" />
			<property name="hibernateQueriesTemplate" value="queries*.hbm.xml" />
			<property name="mappingResources">
				<array>
					<value>persistence/hibernate/queries/</value>
				</array>
			</property>
		</bean>

		<tx:advice id="txAdvice" transaction-manager="transactionManager">
			<tx:attributes>
				<tx:method name="get*" read-only="true" />
				<tx:method name="find*" read-only="true" />
				<tx:method name="search*" read-only="true" />
				<tx:method name="add*" propagation="REQUIRED" />
				<tx:method name="update*" propagation="REQUIRED" />
				<tx:method name="remove*" propagation="REQUIRED" />
				<tx:method name="create*" propagation="REQUIRED" />
				<tx:method name="save*" propagation="REQUIRED" />
				<tx:method name="*"
					no-rollback-for="ftp.core.service.face.tx.FtpServerException" />
			</tx:attributes>
		</tx:advice>

		<aop:config>

			<aop:pointcut id="allServices" expression="execution(* ftp.core..tx..*.*(..))" />

			<aop:advisor advice-ref="txAdvice" pointcut-ref="allServices"
				order="200" />

		</aop:config>

		<bean id="transactionTemplate"
			class="org.springframework.transaction.support.TransactionTemplate">
			<property name="transactionManager" ref="transactionManager" />
		</bean>

	</beans>

</beans>